# RK3588 Media Controller æ‹“æ‰‘å›¾

## æ•°æ®æµå‘ï¼šSensor â†’ DPHY â†’ CSI2 â†’ CIF (ä»å·¦åˆ°å³)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  m02_b_imx415 7-001a    â”‚
â”‚  (Sensor)                â”‚
â”‚  /dev/v4l-subdev2        â”‚
â”‚                          â”‚
â”‚  Format:                 â”‚
â”‚  SGBRG10_1X10            â”‚
â”‚  3864x2192@10000/300000  â”‚
â”‚  crop: (12,16)/3840x2160 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ [ENABLED] ğŸŸ¢
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  rockchip-csi2-dphy0    â”‚
â”‚  (DPHY)                  â”‚
â”‚  /dev/v4l-subdev1        â”‚
â”‚                          â”‚
â”‚  Input:                  â”‚
â”‚  SGBRG10_1X10            â”‚
â”‚  3864x2192@10000/300000  â”‚
â”‚  crop: (12,16)/3840x2160 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ [ENABLED] ğŸŸ¢
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  rockchip-mipi-csi2                                                         â”‚
â”‚  (CSI2)                                                                      â”‚
â”‚  /dev/v4l-subdev0                                                            â”‚
â”‚                                                                              â”‚
â”‚  Input (pad0):                                                               â”‚
â”‚    Format: SGBRG10_1X10/3864x2192                                           â”‚
â”‚    crop.bounds: (12,16)/3840x2160                                            â”‚
â”‚    crop: (12,16)/3840x2160                                                   â”‚
â”‚                                                                              â”‚
â”‚  Outputs (pad1-pad11):                                                       â”‚
â”‚    pad1 â”€â”€ğŸŸ¢â”€â”€> stream_cif_mipi_id0 (/dev/video0)                            â”‚
â”‚    pad2 â”€â”€ğŸŸ¢â”€â”€> stream_cif_mipi_id1 (/dev/video1)                            â”‚
â”‚    pad3 â”€â”€ğŸŸ¢â”€â”€> stream_cif_mipi_id2 (/dev/video2)                            â”‚
â”‚    pad4 â”€â”€ğŸŸ¢â”€â”€> stream_cif_mipi_id3 (/dev/video3)                            â”‚
â”‚    pad5 â”€â”€ğŸŸ¢â”€â”€> rkcif_scale_ch0 (/dev/video4)                                â”‚
â”‚    pad6 â”€â”€ğŸŸ¢â”€â”€> rkcif_scale_ch1 (/dev/video5)                                â”‚
â”‚    pad7 â”€â”€ğŸŸ¢â”€â”€> rkcif_scale_ch2 (/dev/video6)                                â”‚
â”‚    pad8 â”€â”€ğŸŸ¢â”€â”€> rkcif_scale_ch3 (/dev/video7)                                â”‚
â”‚    pad9 â”€â”€ğŸŸ¢â”€â”€> rkcif_tools_id0 (/dev/video8)                                 â”‚
â”‚    pad10 â”€ğŸŸ¢â”€â”€> rkcif_tools_id1 (/dev/video9)                                â”‚
â”‚    pad11 â”€ğŸŸ¢â”€â”€> rkcif_tools_id2 (/dev/video10)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ [æ‰€æœ‰è¾“å‡ºå‡ä¸º ENABLED] ğŸŸ¢
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                                                                 â”‚
           â–¼                    â–¼                    â–¼                    â–¼  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”â”‚
â”‚stream_cif_mipi_  â”‚  â”‚stream_cif_mipi_  â”‚  â”‚stream_cif_mipi_  â”‚  â”‚streamâ”‚â”‚
â”‚id0               â”‚  â”‚id1               â”‚  â”‚id2               â”‚  â”‚_cif_ â”‚â”‚
â”‚/dev/video0       â”‚  â”‚/dev/video1       â”‚  â”‚/dev/video2       â”‚  â”‚mipi_ â”‚â”‚
â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚id3   â”‚â”‚
â”‚[ENABLED] ğŸŸ¢      â”‚  â”‚[ENABLED] ğŸŸ¢      â”‚  â”‚[ENABLED] ğŸŸ¢      â”‚  â”‚/dev/ â”‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚video3â”‚â”‚
                                                                     â”‚      â”‚â”‚
           â–¼                    â–¼                    â–¼              â”‚ğŸŸ¢    â”‚â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â””â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚rkcif_scale_ch0   â”‚  â”‚rkcif_scale_ch1   â”‚  â”‚rkcif_scale_ch2   â”‚          â”‚
â”‚/dev/video4       â”‚  â”‚/dev/video5       â”‚  â”‚/dev/video6       â”‚          â”‚
â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚          â”‚
â”‚[ENABLED] ğŸŸ¢      â”‚  â”‚[ENABLED] ğŸŸ¢      â”‚  â”‚[ENABLED] ğŸŸ¢      â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                                                                           â”‚
           â–¼                    â–¼                    â–¼                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚rkcif_scale_ch3   â”‚  â”‚rkcif_tools_id0   â”‚  â”‚rkcif_tools_id1   â”‚         â”‚
â”‚/dev/video7       â”‚  â”‚/dev/video8       â”‚  â”‚/dev/video9       â”‚         â”‚
â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚         â”‚
â”‚[ENABLED] ğŸŸ¢      â”‚  â”‚[ENABLED] ğŸŸ¢      â”‚  â”‚[ENABLED] ğŸŸ¢      â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                                                                          â”‚
           â–¼                                                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚rkcif_tools_id2   â”‚                                                     â”‚
â”‚/dev/video10      â”‚                                                     â”‚
â”‚                  â”‚                                                     â”‚
â”‚[ENABLED] ğŸŸ¢      â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
                                                                         â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è¯¦ç»†è¯´æ˜

### 1. Sensor å±‚
- **è®¾å¤‡**: `m02_b_imx415 7-001a` (`/dev/v4l-subdev2`)
- **æ ¼å¼**: SGBRG10_1X10 (10-bit Bayer)
- **åˆ†è¾¨ç‡**: 3864x2192 @ 10fps/300fps
- **è£å‰ªåŒºåŸŸ**: (12,16)/3840x2160

### 2. DPHY å±‚
- **è®¾å¤‡**: `rockchip-csi2-dphy0` (`/dev/v4l-subdev1`)
- **åŠŸèƒ½**: MIPI CSI-2 D-PHY ç‰©ç†å±‚æ¥å£
- **çŠ¶æ€**: âœ… ENABLED (è¿æ¥åˆ° Sensor)

### 3. CSI2 å±‚
- **è®¾å¤‡**: `rockchip-mipi-csi2` (`/dev/v4l-subdev0`)
- **åŠŸèƒ½**: MIPI CSI-2 æ§åˆ¶å™¨ï¼Œæ”¯æŒå¤šè·¯è¾“å‡º
- **è¾“å…¥æ ¼å¼**: SGBRG10_1X10/3864x2192
- **è¾“å‡ºé€šé“**: 11 ä¸ªè¾“å‡º pad (pad1-pad11)
- **çŠ¶æ€**: âœ… æ‰€æœ‰ 11 ä¸ªè¾“å‡ºé€šé“å‡ä¸º ENABLED

### 4. CIF å±‚ (Camera Interface)
æ‰€æœ‰è¾“å‡ºé€šé“å‡ä¸º **ENABLED** ğŸŸ¢ï¼š

#### 4.1 åŸå§‹æµé€šé“ (Raw Stream Channels)
- `stream_cif_mipi_id0` â†’ `/dev/video0` ğŸŸ¢
- `stream_cif_mipi_id1` â†’ `/dev/video1` ğŸŸ¢
- `stream_cif_mipi_id2` â†’ `/dev/video2` ğŸŸ¢
- `stream_cif_mipi_id3` â†’ `/dev/video3` ğŸŸ¢

#### 4.2 ç¼©æ”¾é€šé“ (Scale Channels)
- `rkcif_scale_ch0` â†’ `/dev/video4` ğŸŸ¢
- `rkcif_scale_ch1` â†’ `/dev/video5` ğŸŸ¢
- `rkcif_scale_ch2` â†’ `/dev/video6` ğŸŸ¢
- `rkcif_scale_ch3` â†’ `/dev/video7` ğŸŸ¢

#### 4.3 å·¥å…·é€šé“ (Tools Channels)
- `rkcif_tools_id0` â†’ `/dev/video8` ğŸŸ¢
- `rkcif_tools_id1` â†’ `/dev/video9` ğŸŸ¢
- `rkcif_tools_id2` â†’ `/dev/video10` ğŸŸ¢

## å…³é”®ä¿¡æ¯

1. **æ‰€æœ‰é“¾è·¯å‡ä¸º ENABLED** ğŸŸ¢ - è¡¨ç¤ºå½“å‰æ‰€æœ‰ 11 ä¸ª CIF è¾“å‡ºé€šé“éƒ½å·²æ¿€æ´»
2. **æ•°æ®æµå‘**: Sensor â†’ DPHY â†’ CSI2 â†’ CIF (11 è·¯å¹¶è¡Œè¾“å‡º)
3. **è§†é¢‘è®¾å¤‡èŠ‚ç‚¹**: `/dev/video0` åˆ° `/dev/video10` å…± 11 ä¸ªè®¾å¤‡
4. **è¾“å…¥æ ¼å¼**: 10-bit Bayer (SGBRG10_1X10)ï¼ŒåŸå§‹åˆ†è¾¨ç‡ 3864x2192ï¼Œè£å‰ªå 3840x2160

## ä½¿ç”¨å»ºè®®

- **åŸå§‹æµé€šé“** (`/dev/video0-3`): ç”¨äºè·å–åŸå§‹å›¾åƒæ•°æ®
- **ç¼©æ”¾é€šé“** (`/dev/video4-7`): ç”¨äºè·å–ç¼©æ”¾åçš„å›¾åƒæ•°æ®
- **å·¥å…·é€šé“** (`/dev/video8-10`): ç”¨äºè°ƒè¯•å’Œåˆ†æå·¥å…·

åœ¨ `test_mpi_vi` ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ `/dev/video62` ç­‰ ISP è¾“å‡ºèŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯è¿™äº› CIF åŸå§‹è¾“å‡ºèŠ‚ç‚¹ã€‚

